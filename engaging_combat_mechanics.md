# Engaging Combat Mechanics Design

## Overview

This document outlines the specific mechanics that transform basic combat into an engaging, skill-based experience that remains fun during extended play sessions. These systems focus on player agency, tactical depth, and meaningful choices.

## Combo System Design

### Ability Chain Mechanics

The combo system creates engaging gameplay by rewarding players for chaining abilities in sequence, with each successful combo building toward more powerful effects.

```rust
#[derive(Component, Debug)]
pub struct ComboSystem {
    pub active_chains: Vec<ComboChain>,
    pub combo_window: f32,
    pub max_combo_length: u32,
    pub combo_decay_rate: f32,
    pub global_combo_points: u32,
    pub max_global_combo_points: u32,
}

#[derive(Debug, Clone)]
pub struct ComboChain {
    pub chain_id: String,
    pub abilities: Vec<String>,
    pub current_step: u32,
    pub time_remaining: f32,
    pub bonus_effects: Vec<ComboEffect>,
}

#[derive(Debug, Clone)]
pub enum ComboEffect {
    DamageMultiplier(f32),
    CooldownReduction(f32),
    ResourceRefund(ResourceType, f32),
    StatusEffectBonus(String),
    AdditionalTargets(u32),
    CriticalChanceBonus(f32),
}
```

### Implementation Strategy

**Combo Recognition System**
- Track ability usage patterns and timing
- Validate combo prerequisites (target state, resources, positioning)
- Provide visual feedback for available combo opportunities
- Support both rigid sequences and flexible combo trees

**Dynamic Combo Windows**
- Base combo window: 4 seconds
- Skill-based window extension: +0.5s per 10 skill levels
- Combat state modifiers: haste effects extend windows
- Difficulty scaling: more challenging combos have longer windows

**Combo Rewards**
- **2-Ability Combo**: +25% damage, visual flourish
- **3-Ability Combo**: +50% damage, small AoE effect
- **4+ Ability Combo**: +100% damage, special effects, resource generation

### Specific Combo Examples

**Warrior Combo Chain: "Blade Storm"**
1. **Basic Slash** → **Power Strike** → **Whirlwind**
   - Effect: Each enemy hit by Whirlwind reduces all cooldowns by 1 second
   - Visual: Spinning blade effects with increasing intensity

**Mage Combo Chain: "Elemental Cascade"**
1. **Fireball** → **Ice Shard** → **Lightning Bolt**
   - Effect: Final ability hits all enemies affected by previous elements
   - Visual: Tri-colored magical explosion with particle streams

**Healer Combo Chain: "Divine Intervention"**
1. **Heal** → **Blessing** → **Guardian Angel**
   - Effect: Protected ally becomes immune to damage for 3 seconds
   - Visual: Golden shield aura with floating light effects

## Resource Management Systems

### Multi-Resource Strategy

Different character builds use different resource combinations, creating distinct gameplay patterns and strategic decisions.

```rust
#[derive(Debug, Clone)]
pub enum ResourceType {
    Mana,       // Large pool, slow regen, high-cost abilities
    Stamina,    // Medium pool, fast regen, physical abilities
    Focus,      // Small pool, moderate regen, utility abilities
    Rage,       // Generated in combat, decays out of combat
    ComboPoints, // Generated by builders, consumed by finishers
    Energy,     // Fast regen, consistent abilities
    SoulPower,  // Rare resource, extremely powerful abilities
}

#[derive(Component, Debug)]
pub struct ResourceManagement {
    pub resources: HashMap<ResourceType, ResourcePool>,
    pub regeneration_modifiers: HashMap<ResourceType, f32>,
    pub efficiency_bonuses: HashMap<ResourceType, f32>,
    pub synergy_effects: Vec<ResourceSynergy>,
}

#[derive(Debug)]
pub struct ResourcePool {
    pub current: f32,
    pub maximum: f32,
    pub base_regen: f32,
    pub combat_regen: f32,
    pub out_of_combat_regen: f32,
    pub last_usage: f32,
}

#[derive(Debug, Clone)]
pub struct ResourceSynergy {
    pub primary_resource: ResourceType,
    pub secondary_resource: ResourceType,
    pub synergy_type: SynergyType,
    pub threshold: f32,
    pub bonus: f32,
}

#[derive(Debug, Clone)]
pub enum SynergyType {
    ConversionBonus,    // Using one resource boosts another
    EfficiencyBonus,    // High levels of one reduce costs of another
    RegenBonus,         // One resource boosts regen of another
    CapacityBonus,      // One resource increases max of another
}
```

### Strategic Resource Gameplay

**Burst vs Sustain Decisions**
- High-cost abilities for immediate impact vs efficient abilities for long encounters
- Resource conservation during exploration vs aggressive resource spending in combat
- Emergency resource items create tactical opportunities with cooldowns

**Resource Synergy Examples**
- **Mage**: High mana enables powerful spells, but managing focus prevents spell interruption
- **Warrior**: Stamina powers abilities, but rage generation creates burst opportunities
- **Rogue**: Energy provides consistent abilities, combo points enable powerful finishers

**Resource Recovery Mechanics**
- **Out-of-Combat Bonus**: 3x regeneration rate when not engaged
- **Rest Points**: Inn/campfire locations provide temporary regen bonuses
- **Skill-Based Recovery**: Higher skill levels improve resource efficiency
- **Equipment Effects**: Gear can modify resource pools and regeneration

## Positioning and Environmental Mechanics

### Dynamic Positioning System

```rust
#[derive(Component, Debug)]
pub struct PositionalCombat {
    pub flanking_bonus: f32,
    pub elevation_bonus: f32,
    pub range_optimal: f32,
    pub range_penalty_start: f32,
    pub movement_penalty: f32,
    pub terrain_effects: Vec<TerrainEffect>,
}

#[derive(Debug, Clone)]
pub struct TerrainEffect {
    pub effect_type: TerrainEffectType,
    pub area: Vec3, // Center position
    pub radius: f32,
    pub intensity: f32,
    pub duration: Option<f32>,
}

#[derive(Debug, Clone)]
pub enum TerrainEffectType {
    HighGround,         // +damage for ranged, +visibility
    Cover,              // -damage from ranged attacks
    DifficultTerrain,   // -movement speed
    ElementalHazard,    // Periodic damage of specific type
    MagicalResonance,   // +mana regen, +spell effectiveness
    Concealment,        // +stealth, breaks on attack
}
```

### Tactical Positioning Benefits

**Flanking System**
- Side attacks: +15% damage
- Rear attacks: +25% damage, +10% critical chance
- Multiple attackers: Additional +5% per flanking ally
- Movement skills gain strategic value for positioning

**Elevation Advantages**
- Higher ground: +20% ranged damage, +1 range
- Line of sight benefits for spells and ranged attacks
- Fall damage creates risk/reward for elevated positions
- Knockdown effects become more dangerous from height

**Environmental Interactions**
- **Destructible Cover**: Objects can be destroyed to remove enemy protection
- **Elemental Interactions**: Fire spells ignite oil, ice spells freeze water
- **Interactive Objects**: Explosive barrels, collapsing structures, magical artifacts
- **Dynamic Hazards**: Lava flows, poison clouds, magical storms

## Counter-Play and Reactive Mechanics

### Defensive Abilities

```rust
#[derive(Debug, Clone)]
pub enum DefensiveAbility {
    Block {
        damage_reduction: f32,
        duration: f32,
        resource_cost: f32,
        counter_attack_chance: f32,
    },
    Dodge {
        invulnerability_frames: f32,
        distance: f32,
        resource_cost: f32,
        cooldown: f32,
    },
    Parry {
        perfect_timing_window: f32,
        damage_reflection: f32,
        stun_duration: f32,
        skill_requirement: u32,
    },
    Interrupt {
        cast_time: f32,
        silence_duration: f32,
        range: f32,
        priority_targets: Vec<String>,
    },
}
```

### Active Defense Systems

**Perfect Block/Parry Timing**
- 0.5-second window for perfect blocks with enhanced effects
- Perfect blocks reflect 50% damage back to attacker
- Successful perfect defenses reduce ability cooldowns
- Visual/audio cues help players learn timing

**Dodge Mechanics**
- I-frames (invulnerability) during dodge animation
- Direction-based dodging affects final positioning
- Stamina cost prevents dodge spam
- Distance modifiers based on armor weight

**Interrupt System**
- Cast-time abilities can be interrupted by specific skills
- Interrupted casters suffer brief silence effect
- Channeled abilities can be disrupted at any time
- Counter-interrupts available at high skill levels

### Predictive Combat

**Ability Telegraphs**
- Clear visual indicators for incoming attacks
- Color-coded threat levels (yellow = moderate, red = high damage)
- Audio cues supplement visual telegraphs
- Telegraph timing scales with enemy difficulty

**Attack Patterns**
- Enemies follow learnable attack sequences
- Pattern recognition rewards experienced players
- Boss encounters feature complex pattern phases
- Randomized elements prevent complete predictability

## Risk vs Reward Systems

### High-Risk High-Reward Mechanics

```rust
#[derive(Component, Debug)]
pub struct RiskRewardSystem {
    pub overcast_abilities: Vec<OvercastData>,
    pub berserker_thresholds: Vec<BerserkerThreshold>,
    pub critical_health_bonuses: Vec<CriticalHealthBonus>,
    pub resource_burn_effects: Vec<ResourceBurnEffect>,
}

#[derive(Debug, Clone)]
pub struct OvercastData {
    pub ability_id: String,
    pub base_cost: f32,
    pub overcast_multiplier: f32,
    pub max_overcast_levels: u32,
    pub damage_per_level: f32,
    pub side_effects: Vec<OvercastSideEffect>,
}

#[derive(Debug, Clone)]
pub enum OvercastSideEffect {
    HealthDamage(f32),
    ReducedRegen(f32, f32), // Amount, Duration
    StatusVulnerability(String, f32),
    CooldownIncrease(f32),
}
```

### Risk/Reward Examples

**Overcast Magic**
- Spend additional mana beyond ability cost for increased effect
- Each overcast level: +50% damage, -10% max health for 30 seconds
- Maximum 3 overcast levels per ability
- Risk: Reduced survivability, Reward: Massive damage potential

**Berserker Rage**
- Lower health increases damage output (up to +100% at 10% health)
- Enhanced attack speed and critical chance when below 25% health
- Risk: One mistake is fatal, Reward: Incredible damage potential

**All-or-Nothing Abilities**
- Consume all remaining resources for variable effects
- Damage scales with resources consumed
- Leaves player vulnerable but can turn fights around
- Risk: Complete resource depletion, Reward: Fight-changing burst

## Skill Expression Systems

### Advanced Techniques

**Animation Canceling**
- Skilled players can cancel recovery frames with movement
- Allows for faster ability rotation and improved mobility
- Requires precise timing and understanding of frame data
- Provides mastery goals for dedicated players

**Resource Weaving**
- Optimal ability rotations that maximize resource efficiency
- Complex interactions between different resource types
- Situational optimization based on encounter type
- Separates novice from expert players

**Perfect Execution Bonuses**
- Flawless combo execution provides additional rewards
- No missed abilities, perfect timing windows hit
- Bonus scales with combo length and difficulty
- Visual effects celebrate player skill achievement

### Player Skill Recognition

```rust
#[derive(Component, Debug)]
pub struct SkillTracking {
    pub perfect_combos: u32,
    pub successful_interrupts: u32,
    pub damage_avoided: f32,
    pub resource_efficiency: f32,
    pub combat_rating: f32,
    pub mastery_unlocks: HashSet<String>,
}
```

**Adaptive Difficulty**
- Enemy AI becomes more challenging as player skill improves
- Bonus rewards for players who demonstrate consistent skill
- Optional hard mode encounters for skilled players
- Skill-based matchmaking for group content

**Mastery Rewards**
- Cosmetic effects for demonstrating combat mastery
- Advanced abilities unlock through skill demonstration
- Title and achievement systems recognize combat expertise
- Leaderboards for competitive elements

## Dynamic Combat Events

### Environmental Combat Events

**Elemental Storms**
- Random weather effects that modify combat
- Fire storms boost fire damage, reduce ice effectiveness
- Lightning storms cause chain damage on metal armor wearers
- Ice storms slow movement but boost ice magic

**Terrain Shifts**
- Earthquake events that create new cover and hazards
- Magical anomalies that alter ability effectiveness
- Flooding that changes movement patterns and line of sight
- Volcanic activity that creates lava flows and thermal vents

### Combat Modifiers

**Blessing/Curse Events**
- Temporary world effects that alter combat balance
- Divine blessing: +healing effectiveness for all players
- Arcane instability: Random spell effects on cast
- Demonic influence: +damage dealt and taken by all

**Time-Limited Opportunities**
- Rare spawns with unique mechanics and rewards
- Environmental puzzle-bosses requiring specific strategies
- Timed challenges that test different combat skills
- Seasonal events with modified combat rules

This system of engaging mechanics transforms basic combat into a deep, skill-based experience that rewards mastery while remaining accessible to new players. The combination of combos, resource management, positioning, counter-play, and risk/reward creates the tactical depth necessary for long-term player engagement.